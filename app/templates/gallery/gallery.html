{% extends "base.html" %}
{% block title %}BGRemoval{% endblock %}
{% block content %}

<h2 class="mb-4">Gallery</h2>

<div class="gallery-layout">
  <div class="gallery-sidebar">
    {% if g.user %}
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">New image</h5>
        <form method="post" enctype="multipart/form-data">
          <div class="mb-3">
            <label class="form-label">Image to be cut</label>
            <input class="form-control" type="file" name="subject" accept="image/*" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Background image (optional)</label>
            <input class="form-control" type="file" name="background" accept="image/*">
          </div>

          <div class="mb-3">
            <label class="form-label d-block">Privacy</label>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="visibility" id="vis_public"
                     value="public" checked>
              <label class="form-check-label" for="vis_public">Public</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="visibility" id="vis_private"
                     value="private">
              <label class="form-check-label" for="vis_private">Private</label>
            </div>
          </div>

          <button class="btn btn-primary w-100">Upload</button>
        </form>
      </div>
    </div>
    {% else %}
      <p>To upload please <a href="{{ url_for('auth.login') }}">log in</a>.</p>
    {% endif %}
  </div>

  <div class="gallery-main">
    <div class="gallery-grid">
      {% for comp in compositions %}
        <article class="gallery-card">
          <div class="gallery-image-wrapper">
            <img
              src="{{ url_for('static', filename=comp.output_path) }}"
              class="gallery-img"
              alt="composition"
            >
          </div>

          <div class="gallery-card-body">
            {% if comp.image and comp.image.user %}
<div class="gallery-info-center">
    {% if comp.image.user.profile_image %}
        <img
            src="{{ url_for('static', filename=comp.image.user.profile_image.output_path) }}"
            alt="profilkÃ©p"
            class="uploader-avatar"
        >
    {% else %}
        <div class="uploader-avatar-placeholder"></div>
    {% endif %}

    <div class="uploader-name">{{ comp.image.user.username }}</div>

    <div class="uploaded-at">
        Uploaded at: {{ comp.created_at.strftime("%Y-%m-%d %H:%M") }}
    </div>
</div>


{% endif %}


           <div class="gallery-card-actions">
            <a href="{{ url_for('gallery.composition_detail', comp_id=comp.id) }}"
            class="btn btn-primary btn-sm">
                Open
            </a>
            </div>
          </div>
        </article>
      {% else %}
        <p>Final image isn't yet available</p>
      {% endfor %}
    </div>
  </div>
</div>

{% endblock %}
